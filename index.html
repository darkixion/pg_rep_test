<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>pg_rep_test by darkixion</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>pg_rep_test</h1>
        <h2>A tool to assist with setting up replication in PostgreSQL 9.1+ for the purposes of testing or demonstration.</h2>
        <a href="https://github.com/darkixion/pg_rep_test" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>pg_rep_test</h1>

<p>A tool to assist with setting up replication in PostgreSQL 9.1+ for the
purposes of testing or demonstration.</p>

<pre><code>Usage:
  pg_rep_test [OPTION]

Options:
  -a ARCHIVEDIR          create an archive in the named directory
  -d DIRS                comma-separated list of directory names starting with
                         primary (default: primary,standby1,standby2,...)
  -l LOGFILE             write log messages to a file, but it will not log
                         any pre-check messages
  -L                     enable database logging in every instance
  -p PORTS               comma-separated list of ports to use starting with
                         primary (default: 5530,5531,5532,...)
  -P                     prompt for input of options interactively
  -r REPLICAS            number of replicas to create (default: 1)
  -s fan|tree|chain      replication structure (default: fan)
                         fan = all standbys connect directly to primary
                         tree = one standby connects directly to primary, the
                                remaining ones connect to that standby
                         chain = no more than one standby connects to any node
  -S                     configures all standbys to be synchronous
  -T                     don't generate management tool script file to manage the
                         new instances
  -?                     show this help then exit
</code></pre>

<h2>Example</h2>

<p>To create 5 standbys, the first one connecting to the primary, and the rest
connecting to the first standby, you would run the following:</p>

<pre><code>./pg_rep_test -r 5 -s tree
</code></pre>

<p>This would create a directory named "primary", and 5 directories named
"standby1", "standby2"... "standby5".  Each standby would be configured
to connect to the first standby, and the first standby would connect
to the primary.</p>

<p>This would also produce the following ASCII-diagram which displays the
configuration they were created in and the port numbers used:</p>

<pre><code>[Primary (5530)]
    |
    ---[Standby 1 (5531)]
            |
            ---[Standby 2 (5532)]
            |
            ---[Standby 3 (5533)]
            |
            ---[Standby 4 (5534)]
            |
            ---[Standby 5 (5535)]
</code></pre>

<h2>Replication structures</h2>

<p>These are ASCII-diagrams of the 3 replication structures.</p>

<h3>Fan</h3>

<pre><code>[Primary (5530)]
    |
    ---[Standby 1 (5531)]
    |
    ---[Standby 2 (5532)]
    |
    ---[Standby 3 (5533)]
    |
    ---[Standby 4 (5534)]
</code></pre>

<h3>Tree</h3>

<pre><code>[Primary (5530)]
    |
    ---[Standby 1 (5531)]
            |
            ---[Standby 2 (5532)]
            |
            ---[Standby 3 (5533)]
            |
            ---[Standby 4 (5534)]
</code></pre>

<h3>Chain</h3>

<pre><code>[Primary (5530)]
    |
    ---[Standby 1 (5531)]
            |
            ---[Standby 2 (5532)]
                    |
                    ---[Standby 3 (5533)]
                            |
                            ---[Standby 4 (5534)]
</code></pre>

<h2>Notes</h2>

<p>You can run pg_rep_test without any parameters which will then just create a
primary with a single standby.</p>

<p>If a list of ports isn't specified, it will use a list of unused ports
starting from 5530.  If a port is in use, the next port will be checked and so
on, until every instance has a port it can use.</p>

<p>If the default directory names (i.e. primary, standby1, standby2 etc.) already
exist in the directory then new ones will be generated with a numeric suffix.
(e.g. primary_1, standby1_1 etc.)</p>

<p>All configuration changes that pg_rep_test makes get put into a separate
configuration file called custom.conf.  This is then referenced by
postgresql.conf using an 'include' directive at the end of the file.</p>

<p>A dedicated replication user (with the REPLICATION role attribute) called
rep_user will be created automatically in the primary instance.  This will
then be used by all standbys for streaming replication connections.</p>

<p>A maintenance tool script is generated automatically after creating a set of
instances (unless suppressed with -T).  The following section describes its
use.</p>

<h1>tool(_n).pg_rep_test</h1>

<p>A maintenance tool script to manage sets of instances created by pg_rep_test.
The name of the tool is unique to a set of instances.</p>

<pre><code>Usage:
  ./tool.pg_rep_test [OPTION] [ACTION]

Options:
  -D DATADIRS            comma-separated list of directories of instances
                         to affect
  -m MODE                shutdown mode (smart, fast or immediate); must be
                         used with the 'stop' action
  -l LOGFILE             write log messages to a file
  -?                     show this help then exit

ACTION can be one of:
  status                 lists all managed instances, their ports, data
                         directories and whether they are running or not
  start                  start all or specified instances
  stop                   stops all or specified instances, which can be used
                         with the -m option
  restart                restart all or specified instances
  destroy                stops (if started) and deletes all or specified
                         instances; also deletes this maintenance script
</code></pre>

<h2>Example</h2>

<p>To stop all instances managed by the tool script immediately, you would run
the following:</p>

<pre><code>./tool.pg_rep_test -m immediate stop
</code></pre>

<p>To check the status of all instances managed by the script, you would run:</p>

<pre><code>./tool.pg_rep_test status
</code></pre>

<p>This would produce output similar to the following:</p>

<pre><code>Instance 'primary' on port [5536]: RUNNING
Instance 'standby1' on port [5537]: RUNNING
Instance 'standby2' on port [5538]: RUNNING
</code></pre>

<p>To stop and delete all instances, and the tool script itself, you would run:</p>

<pre><code>./tool.pg_rep_test destroy
</code></pre>

<h2>Notes</h2>

<p>If a set of instances is created by pg_rep_test and a tool.pg_rep_test script
already exists in the same directory, the tool script will be given a distinct
name.  This is so that multiple tool scripts, each associated with a
particular set of instances, can exist alongside each other.  So after the
first script is created, subsequent ones will be named tool_1.pg_rep_test,
tool_2... tool_3... etc.</p>

<h2>License</h2>

<p>pg_rep_test is licensed under The PostgreSQL License
(<a href="http://www.opensource.org/licenses/postgresql">http://www.opensource.org/licenses/postgresql</a>),
which is closely related to the BSD license.</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/darkixion/pg_rep_test/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/darkixion/pg_rep_test/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/darkixion/pg_rep_test"></a> is maintained by <a href="https://github.com/darkixion">darkixion</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-40085049-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>